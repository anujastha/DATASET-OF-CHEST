# -*- coding: utf-8 -*-
"""cvs.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/17viGNXtYbA590KYcAAEHWSVh1lHzoA-E
"""

from google.colab import drive
drive.mount('/content/drive')

import os
import csv

folder_path = '/content/drive/MyDrive/datasets/naya 20/caption'
csv_file_name = 'two.csv'

markers = ['FINDINGS:','IMPRESSION:']

with open(csv_file_name, mode='w', newline='') as csv_file:
    fieldnames = ['File Name'] + markers
    writer = csv.DictWriter(csv_file, fieldnames=fieldnames)

    writer.writeheader()

    for file_name in os.listdir(folder_path):
        if file_name.endswith('.txt'):
            file_path = os.path.join(folder_path, file_name)

            # Read data from the text file
            with open(file_path, 'r') as text_file:
                data = {'File Name': file_name}
                current_marker = None

                for line in text_file:
                    line = line.strip()

                    # Check if the line is a marker
                    for marker in markers:
                        if line.startswith(marker):
                            current_marker = marker
                            data[current_marker] = line[len(marker):].strip()
                            break

                    # If it's not a marker, append the line to the current marker's value
                    if current_marker and not line.startswith(tuple(markers)):
                        data[current_marker] += ' ' + line

                # Write data to CSV file
                writer.writerow(data)

print(f"CSV file '{csv_file_name}' has been created.")



import csv

def convert_csv_to_txt(csv_file_path, txt_file_path):
    try:
        with open(csv_file_path, 'r') as csv_file, open(txt_file_path, 'w') as txt_file:
            csv_reader = csv.reader(csv_file)
            for row in csv_reader:
                # Join the CSV row elements with a tab character (you can change it as needed)
                txt_line = '\t'.join(row)
                txt_file.write(f"{txt_line}\n")
        print(f"Conversion successful. Text file saved at: {txt_file_path}")
    except Exception as e:
        print(f"Error: {e}")

# Example usage:
csv_file_path = '/content/two.csv'
txt_file_path = '/content/output'

convert_csv_to_txt(csv_file_path, txt_file_path)

if 'IMPRESSION' in data:
    caption = data['IMPRESSION']
else:
    caption = data['FINDINGS']

import os
import csv

folder_path = '/content/drive/MyDrive/datasets/naya 20/caption'  # Replace with the path to your folder
csv_file_name = 'output.csv'

# Function to extract findings and impression
def extract_data(file_path):
    with open(file_path, 'r') as text_file:
        data = {'File Name': os.path.basename(file_path)}
        current_marker = None
        for line in text_file:
            line = line.strip()
            if line.startswith('FINDINGS:'):
                current_marker = 'FINDINGS'
                data[current_marker] = line[len('FINDINGS:'):].strip()
            elif line.startswith('IMPRESSION:'):
                current_marker = 'IMPRESSION'
                data[current_marker] = line[len('IMPRESSION:'):].strip()
            elif current_marker:
                data[current_marker] += ' ' + line
    return data

# Process the files and write to CSV
with open(csv_file_name, mode='w', newline='') as csv_file:
    fieldnames = ['File Name', 'Caption']
    writer = csv.DictWriter(csv_file, fieldnames=fieldnames)
    writer.writeheader()

    for file_name in os.listdir(folder_path):
        if file_name.endswith('.txt'):
            file_path = os.path.join(folder_path, file_name)
            data = extract_data(file_path)
            caption = data.get('IMPRESSION', data.get('FINDINGS', 'No impression'))
            writer.writerow({'File Name': file_name, 'Caption': caption})

# Function to convert CSV to text
def convert_csv_to_txt(csv_file_path, txt_file_path):
    with open(csv_file_path, 'r') as csv_file, open(txt_file_path, 'w') as txt_file:
        csv_reader = csv.reader(csv_file)
        for row in csv_reader:
            txt_line = '\t'.join(row)  # Join the CSV row elements with a tab character
            txt_file.write(f"{txt_line}\n")
    print(f"Conversion successful. Text file saved at: {txt_file_path}")

# Example usage
csv_file_path = 'output.csv'
txt_file_path = 'output.txt'
convert_csv_to_txt(csv_file_path, txt_file_path)

from PIL import Image
import os

# Path to the folder containing the images
image_folder = '/content/drive/MyDrive/datasets/Jpg'

# Path to the folder containing the text files
text_folder = '/content/drive/MyDrive/datasets/naya 20/caption'

# Function to open the simultaneous image of the related text file
def open_simultaneous_image(text_file):
    image_file = os.path.join(image_folder, os.path.splitext(text_file)[0] + '.jpg')
    if os.path.exists(image_file):
        img = Image.open(image_file)
        img.show()
    else:
        print('Image not found for', text_file)

# Iterate through the text files and open the simultaneous image
for text_file in os.listdir(text_folder):
    if text_file.endswith('.txt'):
        open_simultaneous_image(text_file)

import os
import csv
from natsort import natsorted

def extract_data(file_path):
    with open(file_path, 'r') as text_file:
        data = {'File Name': os.path.basename(file_path)}
        current_marker = None
        for line in text_file:
            line = line.strip()
            if line.startswith('FINDINGS:'):
                current_marker = 'FINDINGS'
                data[current_marker] = line[len('FINDINGS:'):].strip()
            elif line.startswith('IMPRESSION:'):
                current_marker = 'IMPRESSION'
                data[current_marker] = line[len('IMPRESSION:'):].strip()
            elif current_marker:
                data[current_marker] += ' ' + line
    return data

def process_files(folder_path, csv_file_name):
    with open(csv_file_name, mode='w', newline='') as csv_file:
        fieldnames = ['File Name', 'Caption']
        writer = csv.DictWriter(csv_file, fieldnames=fieldnames)
        writer.writeheader()

        # Get a sorted list of filenames using natsorted
        file_names = natsorted(os.listdir(folder_path))

        for file_name in file_names:
            if file_name.endswith('.txt'):
                file_path = os.path.join(folder_path, file_name)
                data = extract_data(file_path)
                caption = data.get('IMPRESSION', data.get('FINDINGS', 'No impression'))
                writer.writerow({'File Name': file_name, 'Caption': caption})
    print(f"CSV file generated successfully: {csv_file_name}")

def convert_csv_to_txt(csv_file_path, txt_file_path):
    with open(csv_file_path, 'r') as csv_file, open(txt_file_path, 'w') as txt_file:
        csv_reader = csv.reader(csv_file)
        for row in csv_reader:
            txt_line = '\t'.join(row)  # Join the CSV row elements with a tab character
            txt_file.write(f"{txt_line}\n")
    print(f"Conversion successful. Text file saved at: {txt_file_path}")

if __name__ == "__main__":
    folder_path = '/content/drive/MyDrive/datasets/naya 20/caption'
    csv_file_name = 'output of caption.csv'
    txt_file_name = 'output of caption.txt'

    # Process files and write to CSV
    process_files(folder_path, csv_file_name)

    # Convert CSV to text
    convert_csv_to_txt(csv_file_name, txt_file_name)